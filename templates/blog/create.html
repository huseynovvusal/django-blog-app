{% extends 'base.html' %}

{% block title %}New Entry - The Chronicle{% endblock %}

{% block content %}
<!-- QUILL EDITOR STYLES -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
    /* Quill Customization for Minimalism */
    .ql-toolbar.ql-snow {
        border: none !important;
        border-bottom: 1px solid rgba(0,0,0,0.05) !important;
        background: transparent;
        padding: 12px 0 !important;
        position: sticky;
        top: 0;
        z-index: 10;
        background-color: #fcfbf4; /* Match page bg */
        opacity: 0.6;
        transition: opacity 0.2s;
    }
    .ql-toolbar.ql-snow:hover { opacity: 1; }
    
    .ql-container.ql-snow {
        border: none !important;
        font-family: 'Merriweather', serif !important;
        font-size: 1.125rem !important; /* 18px */
        color: #2c2c2c;
    }
    
    .ql-editor {
        padding: 24px 0 !important;
        min-height: 60vh;
        line-height: 1.8;
    }
    .ql-editor.ql-blank::before {
        font-style: italic;
        color: #a0a0a0;
        font-family: 'Merriweather', serif;
    }

    /* Selection Color */
    .ql-editor ::selection { background: #e6e1c5; }
</style>

<div class="max-w-3xl mx-auto py-6 relative">
    <form method="post" class="space-y-6" id="blog-form">
        {% csrf_token %}
        
        <!-- Auto-growing Title Textarea -->
        <div>
            <textarea name="title" required placeholder="Title your thoughts..." autofocus rows="1"
                class="w-full text-4xl md:text-5xl font-serif font-bold bg-transparent border-0 border-b-2 border-transparent focus:border-amber-200 focus:ring-0 placeholder-gray-300 outline-none resize-none overflow-hidden py-4 transition-colors text-gray-900 leading-tight"
                oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
        </div>

        <!-- Quill Editor Container -->
        <div id="editor-container"></div>
        
        <!-- Hidden Input to store HTML content -->
        <input type="hidden" name="content" id="hidden-content">

        <!-- Action Bar -->
        <div class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-gray-100 py-4 px-6 md:px-0 z-50">
            <div class="max-w-3xl mx-auto flex items-center justify-between">
                <a href="{% url 'blog_web:list' %}" class="text-gray-500 hover:text-gray-800 font-ui text-sm font-medium uppercase tracking-wide">Cancel</a>
                <button type="submit" class="bg-gray-900 text-white font-ui font-medium py-3 px-8 hover:bg-black transition-colors uppercase tracking-widest text-sm rounded shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all">
                    Publish Entry
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Quill Script -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
    // Initialize Quill
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        placeholder: 'Start writing your story...',
        modules: {
            toolbar: [
                ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
                ['blockquote', 'code-block'],
                [{ 'header': 1 }, { 'header': 2 }],               // custom button values
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link'],
                ['clean']                                         // remove formatting button
            ]
        }
    });

    // Sync content to hidden input on submit
    var form = document.getElementById('blog-form');
    form.onsubmit = function() {
        var content = document.querySelector('input[name=content]');
        // Get HTML content
        content.value = quill.root.innerHTML;
        
        // Ensure content is not just empty paragraph
        if (quill.getText().trim().length === 0 && content.value === '<p><br></p>') {
            content.value = ''; // trigger required check if possible, or handle server side
        }
    };

    // Title auto-resize on load (same as before)
    const titleArea = document.querySelector('textarea[name="title"]');
    if(titleArea) {
        titleArea.style.height = titleArea.scrollHeight + 'px';
        titleArea.addEventListener('keydown', function(e) {
            if(e.key === 'Enter') {
                e.preventDefault();
                quill.focus(); // Jump to editor
            }
        });
    }
</script>
{% endblock %}
